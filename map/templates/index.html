<!DOCTYPE html>
<html>
<head>
    <title>Многоугольник</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!--
        Укажите свой API-ключ. Тестовый ключ НЕ БУДЕТ работать на других сайтах.
        Получить ключ можно в Кабинете разработчика: https://developer.tech.yandex.ru/keys/
    -->
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&amp;apikey=51bdc255-eac0-4844-bc55-96b4673cf89f" type="text/javascript"></script>
    <script src="polygon.js" type="text/javascript"></script>
	<style>
        html, body, #map {
            width: 100%; height: 100%; padding: 0; margin: 0;
        }
    </style>
</head>
<body>
<div id="map"></div>
<script>
	ymaps.ready(init);

function init() {
    let city_lat = +"{{ city_latitude }}".replace(",", ".");
    let city_log = +"{{ city_longitude }}".replace(",", ".");

    var myMap = new ymaps.Map("map", {
            center: [city_lat, city_log],
            zoom: 11
        }, {
            searchControlProvider: 'yandex#search'
        });

    var region = "{{ region }}";
    var city = "{{ city }}";

    fetch(`http://localhost:8000/api/address/zones/?region=${region}&city=${city}`)
        .then((response) => {
            return response.json()
        }).then((zones) => {
            console.log(zones);

            zones.forEach(element => {
                let color = "";

                switch (element.color) {
                    case "green":
                        color = "#8DC73F";
                        break;
                    case "blue":
                        color = "#337AB7";
                        break;
                    case "red":
                        color = "#DB5454";
                        break;
                    case "yellow":
                        color = "#EAE509";
                        break;
                }

                var zone = new ymaps.Polygon(
                element.coordinates      
                , {
                    // Описываем свойства геообъекта.
                    // Содержимое балуна.
                    hintContent: "Многоугольник"
                }, {
                    fillOpacity: 0.5,
                    fillColor: color,
                    strokeWidth: 3
                });

                myMap.geoObjects.add(zone);
            });
        })
}

</script>
</body>
</html>

